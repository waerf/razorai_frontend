{"ast":null,"code":"export default {\n  name: 'SubscriptionSelector',\n  props: {\n    robotId: {\n      type: Number,\n      required: true\n    },\n    price: {\n      type: Number,\n      default: 1\n    },\n    onClose: {\n      type: Function,\n      required: true\n    },\n    onConfirm: {\n      type: Function,\n      required: true\n    }\n  },\n  data() {\n    return {\n      form: {\n        duration: 1,\n        // 默认选择1天\n        points: this.price,\n        // 使用机器人的积分费率\n        customDays: null // 自定义天数\n      },\n      rules: {\n        duration: [{\n          required: true,\n          message: '请选择订阅时长',\n          trigger: 'change'\n        }],\n        customDays: [{\n          required: true,\n          message: '请输入自定义天数',\n          trigger: 'blur'\n        }, {\n          validator: (rule, value, callback) => {\n            if (value === null || value === undefined || value === '') {\n              callback(new Error('请输入自定义天数'));\n            } else if (isNaN(value) || Number(value) <= 0) {\n              callback(new Error('天数必须大于0'));\n            } else {\n              callback();\n            }\n          },\n          trigger: 'blur'\n        }]\n      }\n    };\n  },\n  mounted() {\n    // 组件挂载时初始化积分\n    this.updatePoints();\n  },\n  watch: {\n    // 监听机器人ID或价格变化，重置表单状态\n    robotId: {\n      handler() {\n        this.resetForm();\n      },\n      immediate: false\n    },\n    price: {\n      handler() {\n        this.resetForm();\n      },\n      immediate: false\n    }\n  },\n  methods: {\n    // 重置表单状态\n    resetForm() {\n      this.form.duration = 1; // 重置为默认1天\n      this.form.customDays = null; // 清空自定义天数\n      this.updatePoints(); // 重新计算积分\n      // 清除表单验证状态\n      this.$nextTick(() => {\n        if (this.$refs.formRef) {\n          this.$refs.formRef.clearValidate();\n        }\n      });\n    },\n    // 更新积分\n    updatePoints() {\n      // 如果是自定义天数\n      if (this.form.duration === 0) {\n        const customDays = Number(this.form.customDays);\n        if (this.form.customDays && customDays > 0) {\n          this.form.points = customDays * this.price; // 使用机器人的积分费率\n        } else {\n          this.form.points = 0;\n        }\n      } else if (this.form.duration) {\n        // 默认选择的时长，自动计算积分\n        this.form.points = this.form.duration * this.price; // 使用机器人的积分费率\n      }\n    },\n    // 确认订阅操作\n    async handleConfirm() {\n      // 表单验证\n      this.$refs.formRef.validate(async valid => {\n        if (valid) {\n          // 如果是自定义模式，需要额外验证自定义天数\n          if (this.form.duration === 0) {\n            const customDays = Number(this.form.customDays);\n            if (!this.form.customDays || isNaN(customDays) || customDays <= 0) {\n              this.$message.error('请输入有效的自定义天数');\n              return;\n            }\n          }\n          try {\n            // 获取实际的订阅天数\n            const actualDuration = this.form.duration === 0 ? Number(this.form.customDays) : this.form.duration;\n            // 调用父组件的确认方法\n            await this.onConfirm(actualDuration, this.form.points);\n            this.handleClose();\n          } catch (error) {\n            console.error('订阅失败：', error);\n            this.$message.error('订阅失败，请稍后重试！');\n          }\n        }\n      });\n    },\n    // 关闭弹窗\n    handleClose() {\n      this.form.customDays = null;\n      this.onClose();\n    },\n    // 格式化积分显示\n    formatPrice(points) {\n      // 当points为0时，返回\"免费\"\n      if (points === 0) {\n        return '免费';\n      }\n      return `${points} 积分`;\n    }\n  }\n};","map":{"version":3,"names":["name","props","robotId","type","Number","required","price","default","onClose","Function","onConfirm","data","form","duration","points","customDays","rules","message","trigger","validator","rule","value","callback","undefined","Error","isNaN","mounted","updatePoints","watch","handler","resetForm","immediate","methods","$nextTick","$refs","formRef","clearValidate","handleConfirm","validate","valid","$message","error","actualDuration","handleClose","console","formatPrice"],"sources":["src/components/SubscriptionSelector.vue"],"sourcesContent":["<template>\n  <div class=\"subscription-selector\">\n    <div class=\"subscription-info\">\n      <el-form :model=\"form\" :rules=\"rules\" ref=\"formRef\" label-width=\"80px\">\n        <el-form-item label=\"订阅时长\" prop=\"duration\">\n          <el-radio-group v-model=\"form.duration\" @change=\"updatePoints\">\n            <el-radio :label=\"1\">1 天</el-radio>\n            <el-radio :label=\"7\">1 周</el-radio>\n            <el-radio :label=\"30\">1 月</el-radio>\n            <el-radio :label=\"180\">6 月</el-radio>\n            <el-radio :label=\"365\">12 月</el-radio>\n            <el-radio :label=\"0\">自定义</el-radio>\n          </el-radio-group>\n        </el-form-item>\n\n        <!-- 自定义输入天数 -->\n        <el-form-item\n          v-if=\"form.duration === 0\"\n          label=\"自定义天数\"\n          prop=\"customDays\"\n        >\n          <el-input\n            v-model.number=\"form.customDays\"\n            placeholder=\"请输入天数\"\n            type=\"number\"\n            @input=\"updatePoints\"\n          />\n        </el-form-item>\n\n        <el-form-item label=\"积分消耗\">\n          <el-input :value=\"formatPrice(form.points)\" disabled />\n        </el-form-item>\n      </el-form>\n    </div>\n\n    <!-- 按钮区域 -->\n    <div class=\"action-buttons\">\n      <el-button @click=\"handleClose\">取消</el-button>\n      <el-button type=\"primary\" @click=\"handleConfirm\">确认</el-button>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: 'SubscriptionSelector',\n  props: {\n    robotId: {\n      type: Number,\n      required: true,\n    },\n    price: {\n      type: Number,\n      default: 1,\n    },\n    onClose: {\n      type: Function,\n      required: true,\n    },\n    onConfirm: {\n      type: Function,\n      required: true,\n    },\n  },\n  data() {\n    return {\n      form: {\n        duration: 1, // 默认选择1天\n        points: this.price, // 使用机器人的积分费率\n        customDays: null, // 自定义天数\n      },\n      rules: {\n        duration: [\n          { required: true, message: '请选择订阅时长', trigger: 'change' },\n        ],\n        customDays: [\n          { required: true, message: '请输入自定义天数', trigger: 'blur' },\n          {\n            validator: (rule, value, callback) => {\n              if (value === null || value === undefined || value === '') {\n                callback(new Error('请输入自定义天数'));\n              } else if (isNaN(value) || Number(value) <= 0) {\n                callback(new Error('天数必须大于0'));\n              } else {\n                callback();\n              }\n            },\n            trigger: 'blur',\n          },\n        ],\n      },\n    };\n  },\n  mounted() {\n    // 组件挂载时初始化积分\n    this.updatePoints();\n  },\n  watch: {\n    // 监听机器人ID或价格变化，重置表单状态\n    robotId: {\n      handler() {\n        this.resetForm();\n      },\n      immediate: false,\n    },\n    price: {\n      handler() {\n        this.resetForm();\n      },\n      immediate: false,\n    },\n  },\n  methods: {\n    // 重置表单状态\n    resetForm() {\n      this.form.duration = 1; // 重置为默认1天\n      this.form.customDays = null; // 清空自定义天数\n      this.updatePoints(); // 重新计算积分\n      // 清除表单验证状态\n      this.$nextTick(() => {\n        if (this.$refs.formRef) {\n          this.$refs.formRef.clearValidate();\n        }\n      });\n    },\n    // 更新积分\n    updatePoints() {\n      // 如果是自定义天数\n      if (this.form.duration === 0) {\n        const customDays = Number(this.form.customDays);\n        if (this.form.customDays && customDays > 0) {\n          this.form.points = customDays * this.price; // 使用机器人的积分费率\n        } else {\n          this.form.points = 0;\n        }\n      } else if (this.form.duration) {\n        // 默认选择的时长，自动计算积分\n        this.form.points = this.form.duration * this.price; // 使用机器人的积分费率\n      }\n    },\n\n    // 确认订阅操作\n    async handleConfirm() {\n      // 表单验证\n      this.$refs.formRef.validate(async (valid) => {\n        if (valid) {\n          // 如果是自定义模式，需要额外验证自定义天数\n          if (this.form.duration === 0) {\n            const customDays = Number(this.form.customDays);\n            if (!this.form.customDays || isNaN(customDays) || customDays <= 0) {\n              this.$message.error('请输入有效的自定义天数');\n              return;\n            }\n          }\n\n          try {\n            // 获取实际的订阅天数\n            const actualDuration =\n              this.form.duration === 0\n                ? Number(this.form.customDays)\n                : this.form.duration;\n            // 调用父组件的确认方法\n            await this.onConfirm(actualDuration, this.form.points);\n            this.handleClose();\n          } catch (error) {\n            console.error('订阅失败：', error);\n            this.$message.error('订阅失败，请稍后重试！');\n          }\n        }\n      });\n    },\n\n    // 关闭弹窗\n    handleClose() {\n      this.form.customDays = null;\n      this.onClose();\n    },\n\n    // 格式化积分显示\n    formatPrice(points) {\n      // 当points为0时，返回\"免费\"\n      if (points === 0) {\n        return '免费';\n      }\n      return `${points} 积分`;\n    },\n  },\n};\n</script>\n\n<style scoped>\n.subscription-selector {\n  padding: 0;\n}\n\n.subscription-info {\n  .el-form {\n    .el-form-item {\n      margin-bottom: 2vw;\n    }\n\n    .el-radio-group {\n      margin-top: 3.5vw;\n      margin-bottom: 0vw;\n      .el-radio {\n        display: block;\n        margin-bottom: 0.5vw;\n        margin-right: 0;\n      }\n    }\n  }\n}\n\n.action-buttons {\n  display: flex;\n  justify-content: flex-end;\n  gap: 10px;\n  margin-top: 20px;\n  padding-top: 10px;\n  border-top: 1px solid #ebeef5;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}