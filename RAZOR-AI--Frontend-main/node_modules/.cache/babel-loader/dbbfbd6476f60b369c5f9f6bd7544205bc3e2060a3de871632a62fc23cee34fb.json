{"ast":null,"code":"import { getRecommendedPosts } from '@/utils/api';\nexport default {\n  data() {\n    return {\n      posts: [],\n      totalCount: 0,\n      loading: false,\n      hasMore: true,\n      activeTab: 'latest',\n      page: 1,\n      pageSize: 10\n    };\n  },\n  created() {\n    this.fetchPosts(true);\n  },\n  methods: {\n    // 获取帖子列表\n    async fetchPosts(reset = false) {\n      if (reset) {\n        this.page = 1;\n        this.posts = [];\n      }\n      this.loading = true;\n      try {\n        const res = await getRecommendedPosts(this.pageSize * this.page);\n        const data = res.data;\n        const records = data.posts || data || [];\n        const total = data.total || records.length;\n        this.totalCount = total;\n        if (records && records.length) {\n          this.posts = records.map(p => {\n            let contentObj = {};\n            try {\n              contentObj = p.postContent ? JSON.parse(p.postContent) : {};\n            } catch (e) {\n              console.error('解析 postContent 失败:', e, p.postContent);\n            }\n            return {\n              id: p.id,\n              // 作者优先用 postContent 内的 author\n              authorName: contentObj.author || p.author?.name || p.authorName || '匿名用户',\n              createTime: p.createdAt || p.createTime || '',\n              title: contentObj.title || p.title || '未命名帖子',\n              excerpt: contentObj.content?.slice(0, 50) || p.excerpt || '',\n              // 截取前50个字作为摘要\n              likeCount: p.likeCount || p.likes || 0,\n              commentCount: p.commentCount || p.comments || 0,\n              views: p.views || 0,\n              tags: contentObj.tags || p.tags || []\n            };\n          });\n          this.hasMore = this.posts.length < this.totalCount;\n        } else {\n          this.hasMore = false;\n        }\n      } catch (error) {\n        console.error('获取帖子失败:', error);\n      } finally {\n        this.loading = false;\n      }\n    },\n    // 加载更多\n    loadMorePosts() {\n      this.page++;\n      this.fetchPosts();\n    },\n    // 切换tab\n    switchTab(tab) {\n      if (this.activeTab === tab) return;\n      this.activeTab = tab;\n      this.fetchPosts(true);\n    },\n    // 获取帖子标签（兜底，避免报错）\n    getPostTags(postId) {\n      const post = this.posts.find(p => p.id === postId);\n      return post && post.tags ? post.tags : [];\n    },\n    // 分享帖子\n    sharePost(postId) {\n      console.log('分享帖子:', postId);\n    }\n  }\n};","map":{"version":3,"names":["getRecommendedPosts","data","posts","totalCount","loading","hasMore","activeTab","page","pageSize","created","fetchPosts","methods","reset","res","records","total","length","map","p","contentObj","postContent","JSON","parse","e","console","error","id","authorName","author","name","createTime","createdAt","title","excerpt","content","slice","likeCount","likes","commentCount","comments","views","tags","loadMorePosts","switchTab","tab","getPostTags","postId","post","find","sharePost","log"],"sources":["src/views/CommunityPage.vue"],"sourcesContent":["<template>\n  <div class=\"community-container\">\n    <!-- 主内容区 -->\n    <main class=\"main-content container\">\n      <div class=\"content-layout\">\n        <!-- 中间帖子列表 -->\n        <section class=\"post-feed\">\n          <!-- 发布按钮 -->\n          <div class=\"action-bar\">\n            <button\n              class=\"primary-btn\"\n              @click=\"$router.push('/community/CreatePost')\"\n            >\n              <i class=\"fa fa-plus-circle mr-2\"></i>\n              <span>发布帖子</span>\n            </button>\n          </div>\n\n          <!-- 筛选区 -->\n          <div class=\"filter-card top-filter\">\n            <div class=\"filter-header\">\n              <h2 class=\"feed-title\">社区讨论</h2>\n              <p class=\"feed-count\">\n                共 <span class=\"count-number\">{{ totalCount }}</span> 个帖子\n              </p>\n            </div>\n\n            <div class=\"filter-tabs\">\n              <button\n                class=\"tab-item\"\n                :class=\"{ active: activeTab === 'latest' }\"\n                @click=\"switchTab('latest')\"\n              >\n                最新\n              </button>\n              <button\n                class=\"tab-item\"\n                :class=\"{ active: activeTab === 'hottest' }\"\n                @click=\"switchTab('hottest')\"\n              >\n                最热\n              </button>\n              <button\n                class=\"tab-item\"\n                :class=\"{ active: activeTab === 'follow' }\"\n                @click=\"switchTab('follow')\"\n              >\n                关注\n              </button>\n            </div>\n          </div>\n\n          <!-- 帖子列表 -->\n          <div class=\"post-list\" id=\"postList\">\n            <article class=\"post-card\" v-for=\"post in posts\" :key=\"post.id\">\n              <div class=\"post-header\">\n                <div class=\"author-info\">\n                  <div class=\"author-name-wrap\">\n                    <p class=\"author-name\">{{ post.authorName }}</p>\n                  </div>\n                  <p class=\"post-time\">{{ post.createTime }}</p>\n                </div>\n              </div>\n\n              <!-- 帖子标题 -->\n              <router-link\n                :to=\"`/community/post/${post.id}`\"\n                class=\"post-title-link\"\n              >\n                <h2 class=\"post-title-title\">{{ post.title }}</h2>\n              </router-link>\n\n              <p class=\"post-excerpt\">{{ post.excerpt }}</p>\n\n              <!-- 标签 -->\n              <div class=\"post-tags\">\n                <span\n                  class=\"tag-item\"\n                  v-for=\"(tag, i) in getPostTags(post.id)\"\n                  :key=\"i\"\n                >\n                  {{ tag }}\n                </span>\n              </div>\n\n              <!-- 点赞评论 -->\n              <div class=\"post-actions\">\n                <div class=\"action-group\">\n                  <!-- 点赞仅展示 -->\n                  <div class=\"action-display\">\n                    <i class=\"fa fa-thumbs-o-up mr-1.5\"></i>\n                    <span>{{ post.likeCount }}</span>\n                  </div>\n                  <!-- 评论仅展示 -->\n                  <div class=\"action-display\">\n                    <i class=\"fa fa-comment-o mr-1.5\"></i>\n                    <span>{{ post.commentCount }}</span>\n                  </div>\n                </div>\n                <div class=\"stats-group\">\n                  <span class=\"post-views\">阅读 {{ post.views }}</span>\n                  <button class=\"share-btn\" @click=\"sharePost(post.id)\">\n                    <i class=\"fa fa-share-alt mr-1.5\"></i>\n                    <span>分享</span>\n                  </button>\n                </div>\n              </div>\n            </article>\n\n            <!-- 无数据提示 -->\n            <div v-if=\"posts.length === 0 && !loading\" class=\"no-posts\">\n              暂无帖子数据\n            </div>\n          </div>\n\n          <!-- 加载中 -->\n          <div v-if=\"loading\" class=\"loading-state\">\n            <i class=\"fa fa-spinner fa-spin\"></i> 加载中...\n          </div>\n\n          <!-- 加载更多 -->\n          <div class=\"load-more\">\n            <button\n              class=\"secondary-btn load-more-btn\"\n              @click=\"loadMorePosts\"\n              v-if=\"hasMore\"\n            >\n              加载更多 <i class=\"fa fa-angle-down ml-2\"></i>\n            </button>\n          </div>\n        </section>\n      </div>\n    </main>\n  </div>\n</template>\n\n<script>\nimport { getRecommendedPosts } from '@/utils/api';\n\nexport default {\n  data() {\n    return {\n      posts: [],\n      totalCount: 0,\n      loading: false,\n      hasMore: true,\n      activeTab: 'latest',\n      page: 1,\n      pageSize: 10,\n    };\n  },\n  created() {\n    this.fetchPosts(true);\n  },\n  methods: {\n    // 获取帖子列表\n    async fetchPosts(reset = false) {\n      if (reset) {\n        this.page = 1;\n        this.posts = [];\n      }\n      this.loading = true;\n      try {\n        const res = await getRecommendedPosts(this.pageSize * this.page);\n        const data = res.data;\n\n        const records = data.posts || data || [];\n        const total = data.total || records.length;\n\n        this.totalCount = total;\n        if (records && records.length) {\n          this.posts = records.map((p) => {\n            let contentObj = {};\n            try {\n              contentObj = p.postContent ? JSON.parse(p.postContent) : {};\n            } catch (e) {\n              console.error('解析 postContent 失败:', e, p.postContent);\n            }\n\n            return {\n              id: p.id,\n              // 作者优先用 postContent 内的 author\n              authorName:\n                contentObj.author ||\n                p.author?.name ||\n                p.authorName ||\n                '匿名用户',\n              createTime: p.createdAt || p.createTime || '',\n              title: contentObj.title || p.title || '未命名帖子',\n              excerpt: contentObj.content?.slice(0, 50) || p.excerpt || '', // 截取前50个字作为摘要\n              likeCount: p.likeCount || p.likes || 0,\n              commentCount: p.commentCount || p.comments || 0,\n              views: p.views || 0,\n              tags: contentObj.tags || p.tags || [],\n            };\n          });\n          this.hasMore = this.posts.length < this.totalCount;\n        } else {\n          this.hasMore = false;\n        }\n      } catch (error) {\n        console.error('获取帖子失败:', error);\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    // 加载更多\n    loadMorePosts() {\n      this.page++;\n      this.fetchPosts();\n    },\n    // 切换tab\n    switchTab(tab) {\n      if (this.activeTab === tab) return;\n      this.activeTab = tab;\n      this.fetchPosts(true);\n    },\n    // 获取帖子标签（兜底，避免报错）\n    getPostTags(postId) {\n      const post = this.posts.find((p) => p.id === postId);\n      return post && post.tags ? post.tags : [];\n    },\n    // 分享帖子\n    sharePost(postId) {\n      console.log('分享帖子:', postId);\n    },\n  },\n};\n</script>\n\n<style scoped>\n/* 基础样式 */\n.community-container {\n  background-color: #f8fafc;\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n  color: #333;\n  min-height: 100vh;\n  display: flex;\n  flex-direction: column;\n}\n\n.container {\n  max-width: 100%;\n  width: 100%;\n  margin: 0;\n  padding: 0 90px; /* 两边保留点空隙 */\n}\n\n.text-primary {\n  color: #0f88eb;\n}\n\n/* 主内容区 */\n.main-content {\n  padding: 25px 0;\n  flex: 1;\n}\n\n.content-layout {\n  display: block; /* 不需要多列 */\n  width: 100%;\n}\n\n.post-feed {\n  flex: 1;\n}\n\n.post-title-link {\n  text-decoration: none;\n}\n\n/* 筛选卡片 */\n.filter-card {\n  background: #fff;\n  border-radius: 8px;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);\n  padding: 20px;\n  margin-bottom: 24px;\n}\n\n.filter-header {\n  margin-bottom: 16px;\n}\n\n.feed-title {\n  font-size: 18px;\n  font-weight: 600;\n  color: #1a1a1a;\n  margin-bottom: 4px;\n}\n\n.feed-count {\n  color: #666;\n  font-size: 14px;\n}\n\n.filter-tabs {\n  display: flex;\n  gap: 4px;\n}\n\n.tab-item {\n  padding: 8px 16px;\n  background: transparent;\n  border: none;\n  border-radius: 6px;\n  font-size: 14px;\n  font-weight: 500;\n  color: #666;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n\n.tab-item:hover {\n  background-color: #f1f5f9;\n  color: #333;\n}\n\n.tab-item.active {\n  background-color: rgba(15, 136, 235, 0.1);\n  color: #0f88eb;\n}\n\n/* 帖子列表 */\n.post-list {\n  display: flex;\n  flex-direction: column;\n  gap: 20px;\n}\n\n.post-card {\n  background: #fff;\n  border-radius: 8px;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);\n  padding: 24px;\n  transition: all 0.3s ease;\n}\n\n.post-card:hover {\n  transform: translateY(-5px);\n  box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);\n}\n\n.post-header {\n  display: flex;\n  justify-content: space-between;\n  margin-bottom: 16px;\n}\n\n.post-author {\n  display: flex;\n  align-items: center;\n}\n\n.author-avatar {\n  width: 48px;\n  height: 48px;\n  border-radius: 50%;\n  object-fit: cover;\n}\n\n.author-info {\n  margin-left: 12px;\n}\n\n.author-name-wrap {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.author-name {\n  font-weight: 600;\n  color: #1a1a1a;\n}\n\n.author-badge {\n  font-size: 12px;\n  padding: 2px 8px;\n  border-radius: 12px;\n  background-color: rgba(15, 136, 235, 0.1);\n  color: #0f88eb;\n}\n\n.post-time {\n  color: #666;\n  margin-top: 4px;\n}\n\n.more-btn {\n  background: transparent;\n  border: none;\n  color: #999;\n  cursor: pointer;\n  transition: color 0.2s ease;\n}\n\n.more-btn:hover {\n  color: #333;\n}\n\n.post-title {\n  font-size: 18px;\n  font-weight: 600;\n  color: #1a1a1a;\n  margin-bottom: 12px;\n  transition: color 0.2s ease;\n}\n\n.post-title:hover {\n  color: #0f88eb;\n}\n\n.title-link {\n  color: #1a1a1a;\n  text-decoration: none;\n  transition: color 0.2s ease;\n}\n\n.title-link:hover {\n  color: #0f88eb;\n}\n\n.post-title-link:hover .post-title-title {\n  color: #0f88eb; /* 浅紫色文字 */\n  transition: color 0.2s ease; /* 平滑过渡效果 */\n}\n\n.tab-item:active,\n.action-btn:active,\n.share-btn:active,\n.secondary-btn:active {\n  color: #0f88eb !important;\n  background-color: rgba(90, 24, 154, 0.1) !important;\n}\n\n/* 链接点击状态 */\n.post-title-link:active .post-title-title {\n  color: #0f88eb !important;\n}\n\n.post-excerpt {\n  color: #666;\n  margin-bottom: 16px;\n  display: -webkit-box;\n  -webkit-line-clamp: 3;\n  -webkit-box-orient: vertical;\n  overflow: hidden;\n}\n\n.post-tags {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n  margin-bottom: 20px;\n}\n\n.tag-item {\n  display: inline-block;\n  padding: 4px 10px;\n  border-radius: 16px;\n  font-size: 13px;\n  background-color: rgba(15, 136, 235, 0.1);\n  color: #0f88eb;\n}\n\n.post-actions {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding-top: 16px;\n  border-top: 1px solid #f1f3f5;\n  color: #666;\n}\n\n.action-group {\n  display: flex;\n  gap: 24px;\n}\n\n.action-btn {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  background: transparent;\n  border: none;\n  color: #666;\n  cursor: pointer;\n  transition: color 0.2s ease;\n  font-size: 14px;\n}\n\n.action-btn:hover {\n  color: #0f88eb;\n}\n\n.stats-group {\n  display: flex;\n  align-items: center;\n  gap: 16px;\n}\n\n.post-views {\n  font-size: 14px;\n}\n\n.share-btn {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  background: transparent;\n  border: none;\n  color: #666;\n  cursor: pointer;\n  transition: color 0.2s ease;\n  font-size: 14px;\n}\n\n.share-btn:hover {\n  color: #0f88eb;\n}\n\n/* 加载更多 */\n.load-more {\n  margin-top: 30px;\n  text-align: center;\n}\n\n.secondary-btn {\n  background-color: #f8f9fa;\n  color: #495057;\n  padding: 10px 20px;\n  border-radius: 6px;\n  font-size: 15px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  border: none;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.secondary-btn:hover {\n  background-color: #e9ecef;\n}\n\n/* 页脚 */\n.main-footer {\n  background-color: #fff;\n  border-top: 1px solid #e2e8f0;\n  padding: 20px 0;\n  margin-top: auto;\n}\n\n.footer-content {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.copyright {\n  color: #666;\n  font-size: 14px;\n}\n\n.footer-links {\n  display: flex;\n  gap: 24px;\n}\n\n.footer-link {\n  color: #666;\n  text-decoration: none;\n  font-size: 14px;\n  transition: color 0.2s ease;\n}\n\n.footer-link:hover {\n  color: #0f88eb;\n}\n\n.action-bar {\n  margin-bottom: 24px;\n  text-align: right;\n}\n\n.primary-btn {\n  background-color: #0f88eb;\n  color: white;\n  padding: 8px 16px;\n  border-radius: 6px;\n  font-size: 14px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  border: none;\n  display: inline-flex;\n  align-items: center;\n}\n\n.primary-btn:hover {\n  background-color: #0a6fcc;\n  box-shadow: 0 4px 8px rgba(15, 136, 235, 0.2);\n}\n\n/* 响应式调整 */\n@media (max-width: 1024px) {\n  .sidebar-right {\n    display: none;\n  }\n}\n\n@media (max-width: 768px) {\n  .sidebar-left {\n    display: none;\n  }\n\n  .main-nav {\n    display: none;\n  }\n\n  .search-box {\n    display: none;\n  }\n\n  .footer-content {\n    flex-direction: column;\n    gap: 16px;\n  }\n\n  .copyright {\n    text-align: center;\n  }\n\n  .footer-links {\n    flex-wrap: wrap;\n    justify-content: center;\n  }\n}\n</style>\n"],"mappings":"AAyIA,SAAAA,mBAAA;AAEA;EACAC,KAAA;IACA;MACAC,KAAA;MACAC,UAAA;MACAC,OAAA;MACAC,OAAA;MACAC,SAAA;MACAC,IAAA;MACAC,QAAA;IACA;EACA;EACAC,QAAA;IACA,KAAAC,UAAA;EACA;EACAC,OAAA;IACA;IACA,MAAAD,WAAAE,KAAA;MACA,IAAAA,KAAA;QACA,KAAAL,IAAA;QACA,KAAAL,KAAA;MACA;MACA,KAAAE,OAAA;MACA;QACA,MAAAS,GAAA,SAAAb,mBAAA,MAAAQ,QAAA,QAAAD,IAAA;QACA,MAAAN,IAAA,GAAAY,GAAA,CAAAZ,IAAA;QAEA,MAAAa,OAAA,GAAAb,IAAA,CAAAC,KAAA,IAAAD,IAAA;QACA,MAAAc,KAAA,GAAAd,IAAA,CAAAc,KAAA,IAAAD,OAAA,CAAAE,MAAA;QAEA,KAAAb,UAAA,GAAAY,KAAA;QACA,IAAAD,OAAA,IAAAA,OAAA,CAAAE,MAAA;UACA,KAAAd,KAAA,GAAAY,OAAA,CAAAG,GAAA,CAAAC,CAAA;YACA,IAAAC,UAAA;YACA;cACAA,UAAA,GAAAD,CAAA,CAAAE,WAAA,GAAAC,IAAA,CAAAC,KAAA,CAAAJ,CAAA,CAAAE,WAAA;YACA,SAAAG,CAAA;cACAC,OAAA,CAAAC,KAAA,uBAAAF,CAAA,EAAAL,CAAA,CAAAE,WAAA;YACA;YAEA;cACAM,EAAA,EAAAR,CAAA,CAAAQ,EAAA;cACA;cACAC,UAAA,EACAR,UAAA,CAAAS,MAAA,IACAV,CAAA,CAAAU,MAAA,EAAAC,IAAA,IACAX,CAAA,CAAAS,UAAA,IACA;cACAG,UAAA,EAAAZ,CAAA,CAAAa,SAAA,IAAAb,CAAA,CAAAY,UAAA;cACAE,KAAA,EAAAb,UAAA,CAAAa,KAAA,IAAAd,CAAA,CAAAc,KAAA;cACAC,OAAA,EAAAd,UAAA,CAAAe,OAAA,EAAAC,KAAA,WAAAjB,CAAA,CAAAe,OAAA;cAAA;cACAG,SAAA,EAAAlB,CAAA,CAAAkB,SAAA,IAAAlB,CAAA,CAAAmB,KAAA;cACAC,YAAA,EAAApB,CAAA,CAAAoB,YAAA,IAAApB,CAAA,CAAAqB,QAAA;cACAC,KAAA,EAAAtB,CAAA,CAAAsB,KAAA;cACAC,IAAA,EAAAtB,UAAA,CAAAsB,IAAA,IAAAvB,CAAA,CAAAuB,IAAA;YACA;UACA;UACA,KAAApC,OAAA,QAAAH,KAAA,CAAAc,MAAA,QAAAb,UAAA;QACA;UACA,KAAAE,OAAA;QACA;MACA,SAAAoB,KAAA;QACAD,OAAA,CAAAC,KAAA,YAAAA,KAAA;MACA;QACA,KAAArB,OAAA;MACA;IACA;IAEA;IACAsC,cAAA;MACA,KAAAnC,IAAA;MACA,KAAAG,UAAA;IACA;IACA;IACAiC,UAAAC,GAAA;MACA,SAAAtC,SAAA,KAAAsC,GAAA;MACA,KAAAtC,SAAA,GAAAsC,GAAA;MACA,KAAAlC,UAAA;IACA;IACA;IACAmC,YAAAC,MAAA;MACA,MAAAC,IAAA,QAAA7C,KAAA,CAAA8C,IAAA,CAAA9B,CAAA,IAAAA,CAAA,CAAAQ,EAAA,KAAAoB,MAAA;MACA,OAAAC,IAAA,IAAAA,IAAA,CAAAN,IAAA,GAAAM,IAAA,CAAAN,IAAA;IACA;IACA;IACAQ,UAAAH,MAAA;MACAtB,OAAA,CAAA0B,GAAA,UAAAJ,MAAA;IACA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}