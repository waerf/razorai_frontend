{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport LoginForm from '@/components/LoginForm.vue'; // 引入登录表单组件\nimport { mapGetters, mapState, mapActions } from 'vuex'; // 引入 mapGetters, mapActions\nimport user from '@/store/user';\nexport default {\n  components: {\n    LoginForm\n  },\n  data() {\n    return {\n      loginDialogVisible: false,\n      isSidebarHidden: false // 控制菜单栏是否隐藏\n    };\n  },\n  created() {\n    // 只有在用户登录时才获取聊天列表\n    if (this.isLoggedIn && this.userId) {\n      this.getAllChats();\n    }\n  },\n  watch: {\n    // 监听登录状态变化，登录后获取聊天列表\n    isLoggedIn(newVal) {\n      if (newVal && this.userId) {\n        this.getAllChats();\n      } else {\n        // 登出时清空聊天列表\n        this.$store.commit('chat/SET_CHATS', []);\n      }\n    },\n    userId(newVal) {\n      if (newVal && this.isLoggedIn) {\n        this.getAllChats();\n      }\n    }\n  },\n  computed: {\n    ...mapGetters('user', ['isLoggedIn', 'userId', 'userName']),\n    // 映射 getters\n    ...mapState('chat', {\n      chatlists: state => state.chats\n    }),\n    ...mapState('user', ['isLoggedIn', 'userName', 'userId', 'token']),\n    // 绑定 Vuex 状态，当信息改变时，自动更新\n    headername() {\n      // 从当前路由的 meta 信息中获取标题\n      console.log('当前路由：', this.$route);\n      this.$message('当前路由：' + this.$route.path);\n      return this.$route.meta.title || '默认标题';\n    }\n  },\n  methods: {\n    ...mapActions('chat', ['fetchChats']),\n    // 映射 actions, 用于获取聊天列表\n    async getAllChats() {\n      // 检查用户是否已登录且有userId\n      if (!this.isLoggedIn || !this.userId) {\n        console.log('用户未登录或userId不存在，跳过获取聊天列表');\n        return;\n      }\n      try {\n        console.log('正在获取聊天列表，用户ID:', this.userId);\n        const response = await this.fetchChats({\n          user_id: this.userId\n        });\n        console.log('获取聊天列表成功：', response);\n        if (response && response.success) {\n          console.log('聊天列表已更新');\n        } else {\n          console.warn('获取聊天列表失败：', response?.message || '未知错误');\n        }\n      } catch (error) {\n        console.error('获取聊天列表失败：', error);\n      }\n    },\n    toggleSidebar() {\n      this.isSidebarHidden = !this.isSidebarHidden;\n    },\n    navigateTo(route) {\n      if (this.$route.name !== route) {\n        this.$router.push({\n          name: route\n        });\n      }\n    },\n    openLoginDialog() {\n      this.loginDialogVisible = true;\n    },\n    // 跳转到聊天详情页\n    navigateToChat(chatId) {\n      // 如果当前页面的id和chatId相同，则不跳转\n      if (this.$route.params.id === chatId) {\n        return;\n      }\n      this.$router.push({\n        name: 'ChatRobot',\n        params: {\n          id: chatId\n        }\n      });\n    }\n  }\n};","map":{"version":3,"names":["LoginForm","mapGetters","mapState","mapActions","user","components","data","loginDialogVisible","isSidebarHidden","created","isLoggedIn","userId","getAllChats","watch","newVal","$store","commit","computed","chatlists","state","chats","headername","console","log","$route","$message","path","meta","title","methods","response","fetchChats","user_id","success","warn","message","error","toggleSidebar","navigateTo","route","name","$router","push","openLoginDialog","navigateToChat","chatId","params","id"],"sources":["src/layouts/defaultLayout.vue"],"sourcesContent":["<!-- src/layouts/defaultLayout.vue -->\n<template>\n  <div class=\"layout-container\">\n    <!-- 左侧菜单栏 -->\n    <aside class=\"sidebar\" :class=\"{ hidden: isSidebarHidden }\">\n      <div class=\"logo-button-container\">\n        <img class=\"logo\" src=\"@/assets/images/logo.png\" alt=\"Logo\" />\n        <div class=\"company-name\">RAZOR-AI</div>\n        <!-- 菜单栏收缩按钮 -->\n        <button\n          class=\"toggle-sidebar-btn\"\n          v-if=\"!isSidebarHidden\"\n          @click=\"toggleSidebar\"\n        >\n          <el-icon name=\"s-fold\"></el-icon>\n        </button>\n      </div>\n\n      <!-- 主要功能区域 -->\n      <div class=\"main-section\">\n        <div class=\"main-section-item\" @click=\"navigateTo('Home')\">\n          <el-icon name=\"s-home\"></el-icon>首页\n        </div>\n        <div class=\"main-section-item\" @click=\"navigateTo('SubscribedBots')\">\n          <el-icon name=\"s-opportunity\"></el-icon>已订阅机器人\n        </div>\n      </div>\n      <div class=\"chat-history\" v-if=\"isLoggedIn && chatlists.length > 0\">\n        <div class=\"chat-history-title\">聊天历史</div>\n        <div\n          class=\"chat-item\"\n          v-for=\"chat in chatlists\"\n          :key=\"chat.id\"\n          @click=\"navigateToChat(chat.id)\"\n          :class=\"{ active: $route.params.id == chat.id }\"\n        >\n          <el-icon name=\"chat-dot-square\" class=\"chat-icon\"></el-icon>\n          <div class=\"chat-content\">\n            <div class=\"chat-name\">{{ chat.name || '未命名对话' }}</div>\n            <div class=\"chat-agent\">{{ chat.agent_name || '未知机器人' }}</div>\n          </div>\n        </div>\n      </div>\n      <div class=\"chat-history\" v-else-if=\"isLoggedIn && chatlists.length === 0\">\n        <div class=\"no-chats\">暂无聊天记录</div>\n      </div>\n      <!-- <div class=\"menu-item\" @click=\"navigateTo('Explorer')\">\n        <el-icon name=\"goods\" class=\"menu-item-icon\"></el-icon>探索机器人\n      </div> -->\n      <!-- <div class=\"menu-item\" @click=\"navigateTo('DeveloperCenter')\">\n        <el-icon name=\"coordinate\" class=\"menu-item-icon\"></el-icon>开发者中心\n      </div> -->\n      <div class=\"menu-item\" @click=\"navigateTo('CreateBots')\">\n        <el-icon name=\"coordinate\" class=\"menu-item-icon\"></el-icon>创造机器人\n      </div>\n      <div class=\"menu-item\" @click=\"navigateTo('PersonalHome')\">\n        <el-icon name=\"s-custom\" class=\"menu-item-icon\"></el-icon>个人主页\n      </div>\n      <!-- <div class=\"menu-item\" @click=\"navigateTo('Test')\">\n        <el-icon name=\"chat-line-round\" class=\"menu-item-icon\"></el-icon\n        >睿择社区\n      </div> -->\n      <!-- <div class=\"menu-item\" @click=\"navigateTo('Setting')\">\n        <el-icon name=\"setting\" class=\"menu-item-icon\"></el-icon>系统设置\n      </div> -->\n      <!-- <div class=\"menu-item\" @click=\"navigateTo('About')\">\n        <el-icon name=\"info\" class=\"menu-item-icon\"></el-icon>关于我们\n      </div> -->\n      <!-- <div class=\"divider\"></div> -->\n      <div class=\"menu-item\" @click=\"navigateTo('Test')\">\n        <el-icon name=\"loading\" class=\"menu-item-icon\"></el-icon>测试页面\n      </div>\n      <!-- <div class=\"menu-item\" @click=\"navigateTo('HelperCenter')\">\n        <el-icon name=\"question\" class=\"menu-item-icon\"></el-icon>帮助中心\n      </div> -->\n    </aside>\n\n    <!-- 右侧内容区域 -->\n    <el-main>\n      <!-- 页头部分 -->\n      <el-header class=\"ourHeader\">\n        <!-- 在侧边栏隐藏时，显示控制按钮 -->\n        <button\n          v-if=\"isSidebarHidden\"\n          class=\"toggle-sidebar-btn in-header\"\n          @click=\"toggleSidebar\"\n        >\n          <el-icon name=\"s-unfold\"></el-icon>\n        </button>\n        <h2 class=\"header-name\">{{ headername }}</h2>\n        <div class=\"user-info\">\n          <el-icon name=\"user\"></el-icon>\n          <span v-if=\"!isLoggedIn\" @click=\"openLoginDialog\">用户登录</span>\n          <span v-else @click=\"navigateTo('PersonalHome')\"\n            >你好，{{ userName }}</span\n          >\n        </div>\n      </el-header>\n      <router-view></router-view>\n    </el-main>\n\n    <!-- 登录对话框 -->\n    <el-dialog\n      :visible.sync=\"loginDialogVisible\"\n      name=\"用户登录\"\n      :modal=\"true\"\n      :close-on-click-modal=\"false\"\n      center\n      width=\"30%\"\n    >\n      <LoginForm @close=\"loginDialogVisible = false\" />\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport LoginForm from '@/components/LoginForm.vue'; // 引入登录表单组件\nimport { mapGetters, mapState, mapActions } from 'vuex'; // 引入 mapGetters, mapActions\nimport user from '@/store/user';\nexport default {\n  components: {\n    LoginForm,\n  },\n  data() {\n    return {\n      loginDialogVisible: false,\n      isSidebarHidden: false, // 控制菜单栏是否隐藏\n    };\n  },\n  created() {\n    // 只有在用户登录时才获取聊天列表\n    if (this.isLoggedIn && this.userId) {\n      this.getAllChats();\n    }\n  },\n  watch: {\n    // 监听登录状态变化，登录后获取聊天列表\n    isLoggedIn(newVal) {\n      if (newVal && this.userId) {\n        this.getAllChats();\n      } else {\n        // 登出时清空聊天列表\n        this.$store.commit('chat/SET_CHATS', []);\n      }\n    },\n    userId(newVal) {\n      if (newVal && this.isLoggedIn) {\n        this.getAllChats();\n      }\n    }\n  },\n  computed: {\n    ...mapGetters('user', ['isLoggedIn', 'userId', 'userName']), // 映射 getters\n    ...mapState('chat', {\n      chatlists: (state) => state.chats,\n    }),\n    ...mapState('user', ['isLoggedIn', 'userName', 'userId', 'token']), // 绑定 Vuex 状态，当信息改变时，自动更新\n    headername() {\n      // 从当前路由的 meta 信息中获取标题\n      console.log('当前路由：', this.$route);\n      this.$message('当前路由：' + this.$route.path);\n      return this.$route.meta.title || '默认标题';\n    },\n  },\n  methods: {\n    ...mapActions('chat', ['fetchChats']), // 映射 actions, 用于获取聊天列表\n    async getAllChats() {\n      // 检查用户是否已登录且有userId\n      if (!this.isLoggedIn || !this.userId) {\n        console.log('用户未登录或userId不存在，跳过获取聊天列表');\n        return;\n      }\n\n      try {\n        console.log('正在获取聊天列表，用户ID:', this.userId);\n        const response = await this.fetchChats({\n          user_id: this.userId,\n        });\n        console.log('获取聊天列表成功：', response);\n        if (response && response.success) {\n          console.log('聊天列表已更新');\n        } else {\n          console.warn('获取聊天列表失败：', response?.message || '未知错误');\n        }\n      } catch (error) {\n        console.error('获取聊天列表失败：', error);\n      }\n    },\n    toggleSidebar() {\n      this.isSidebarHidden = !this.isSidebarHidden;\n    },\n    navigateTo(route) {\n      if (this.$route.name !== route) {\n        this.$router.push({ name: route });\n      }\n    },\n    openLoginDialog() {\n      this.loginDialogVisible = true;\n    },\n    // 跳转到聊天详情页\n    navigateToChat(chatId) {\n      // 如果当前页面的id和chatId相同，则不跳转\n      if (this.$route.params.id === chatId) {\n        return;\n      }\n      this.$router.push({ name: 'ChatRobot', params: { id: chatId } });\n    },\n  },\n};\n</script>\n<style lang=\"scss\" scoped>\n@use '@/assets/styles/layout.scss' as *;\n.el-main {\n  padding: 0px;\n}\n\n.toggle-sidebar-btn {\n  cursor: pointer;\n  font-size: 1.5rem;\n}\n</style>\n"],"mappings":";AAoHA,OAAAA,SAAA;AACA,SAAAC,UAAA,EAAAC,QAAA,EAAAC,UAAA;AACA,OAAAC,IAAA;AACA;EACAC,UAAA;IACAL;EACA;EACAM,KAAA;IACA;MACAC,kBAAA;MACAC,eAAA;IACA;EACA;EACAC,QAAA;IACA;IACA,SAAAC,UAAA,SAAAC,MAAA;MACA,KAAAC,WAAA;IACA;EACA;EACAC,KAAA;IACA;IACAH,WAAAI,MAAA;MACA,IAAAA,MAAA,SAAAH,MAAA;QACA,KAAAC,WAAA;MACA;QACA;QACA,KAAAG,MAAA,CAAAC,MAAA;MACA;IACA;IACAL,OAAAG,MAAA;MACA,IAAAA,MAAA,SAAAJ,UAAA;QACA,KAAAE,WAAA;MACA;IACA;EACA;EACAK,QAAA;IACA,GAAAhB,UAAA;IAAA;IACA,GAAAC,QAAA;MACAgB,SAAA,EAAAC,KAAA,IAAAA,KAAA,CAAAC;IACA;IACA,GAAAlB,QAAA;IAAA;IACAmB,WAAA;MACA;MACAC,OAAA,CAAAC,GAAA,eAAAC,MAAA;MACA,KAAAC,QAAA,gBAAAD,MAAA,CAAAE,IAAA;MACA,YAAAF,MAAA,CAAAG,IAAA,CAAAC,KAAA;IACA;EACA;EACAC,OAAA;IACA,GAAA1B,UAAA;IAAA;IACA,MAAAS,YAAA;MACA;MACA,UAAAF,UAAA,UAAAC,MAAA;QACAW,OAAA,CAAAC,GAAA;QACA;MACA;MAEA;QACAD,OAAA,CAAAC,GAAA,wBAAAZ,MAAA;QACA,MAAAmB,QAAA,cAAAC,UAAA;UACAC,OAAA,OAAArB;QACA;QACAW,OAAA,CAAAC,GAAA,cAAAO,QAAA;QACA,IAAAA,QAAA,IAAAA,QAAA,CAAAG,OAAA;UACAX,OAAA,CAAAC,GAAA;QACA;UACAD,OAAA,CAAAY,IAAA,cAAAJ,QAAA,EAAAK,OAAA;QACA;MACA,SAAAC,KAAA;QACAd,OAAA,CAAAc,KAAA,cAAAA,KAAA;MACA;IACA;IACAC,cAAA;MACA,KAAA7B,eAAA,SAAAA,eAAA;IACA;IACA8B,WAAAC,KAAA;MACA,SAAAf,MAAA,CAAAgB,IAAA,KAAAD,KAAA;QACA,KAAAE,OAAA,CAAAC,IAAA;UAAAF,IAAA,EAAAD;QAAA;MACA;IACA;IACAI,gBAAA;MACA,KAAApC,kBAAA;IACA;IACA;IACAqC,eAAAC,MAAA;MACA;MACA,SAAArB,MAAA,CAAAsB,MAAA,CAAAC,EAAA,KAAAF,MAAA;QACA;MACA;MACA,KAAAJ,OAAA,CAAAC,IAAA;QAAAF,IAAA;QAAAM,MAAA;UAAAC,EAAA,EAAAF;QAAA;MAAA;IACA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}